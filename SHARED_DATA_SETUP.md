# 🎯 Shared Data with Login Code

## ✅ ระบบใหม่: ทุกเครื่องเห็นข้อมูลเดียวกัน!

ตอนนี้ระบบใช้ **Login Code** เป็น Document ID แทน Firebase Anonymous UID

### 📊 โครงสร้าง Firestore

```
Firestore Database
├── inventory/
│   ├── 9999           ← พนักงานทุกเครื่องที่ใช้รหัส 9999 เห็นข้อมูลเดียวกัน
│   └── 552499         ← ผู้จัดการทุกเครื่องที่ใช้รหัส 552499 เห็นข้อมูลเดียวกัน
├── settings/
│   ├── 9999           ← การตั้งค่าของพนักงาน
│   └── 552499         ← การตั้งค่าของผู้จัดการ
├── audit/
│   ├── 9999           ← ประวัติการทำงานของพนักงาน
│   └── 552499         ← ประวัติการทำงานของผู้จัดการ
└── counts/
    ├── 9999           ← บันทึกการนับของพนักงาน
    └── 552499         ← บันทึกการนับของผู้จัดการ
```

---

## 🎉 ผลลัพธ์

### พนักงาน (รหัส: 9999)

```
📱 มือถือเครื่อง 1 → Login: 9999 → เห็นข้อมูลชุด "9999"
💻 คอมพิวเตอร์    → Login: 9999 → เห็นข้อมูลชุด "9999"
📱 มือถือเครื่อง 2 → Login: 9999 → เห็นข้อมูลชุด "9999"
📱 iPad           → Login: 9999 → เห็นข้อมูลชุด "9999"

✅ ทุกเครื่องเห็นข้อมูลเดียวกัน!
✅ เพิ่มสินค้าที่เครื่องนึง เครื่องอื่นเห็นทันที (เมื่อรีเฟรช)
✅ นับสต็อกที่ไหนก็ได้ ข้อมูลอัพเดททุกเครื่อง
```

### ผู้จัดการ (รหัส: 552499)

```
📱 มือถือ Boss   → Login: 552499 → เห็นข้อมูลชุด "552499"
💻 คอมพิวเตอร์  → Login: 552499 → เห็นข้อมูลชุด "552499"
🖥️ PC ออฟฟิศ   → Login: 552499 → เห็นข้อมูลชุด "552499"

✅ ทุกเครื่องเห็นข้อมูลเดียวกัน!
✅ จัดการสต็อกที่ไหนก็ได้
✅ ดูรายงานได้จากทุกอุปกรณ์
```

---

## 🔑 วิธีใช้งาน

### 1. Login แรก (พนักงาน)
```
1. เปิดแอป
2. รอ Firebase พร้อม (5-10 วินาที)
3. กรอกรหัส: 0000
4. กด "เข้าสู่ระบบ"
5. รอโหลดข้อมูล (ครั้งแรกจะโหลด seed 47 รายการ)
6. เข้าสู่ Dashboard
```

### 2. Login เครื่องอื่น (พนักงาน)
```
1. เปิดแอปบนเครื่องใหม่
2. รอ Firebase พร้อม
3. กรอกรหัส: 0000
4. กด "เข้าสู่ระบบ"
5. โหลดข้อมูลเดียวกันกับเครื่องแรก
6. ✅ เห็นสินค้าทั้งหมดที่มีอยู่แล้ว!
```

### 3. การทำงานร่วมกัน
```
เครื่อง A (พนักงาน):
- Login: 0000
- เพิ่มสินค้า "น้ำอัดลม" 
- บันทึก ✅

เครื่อง B (พนักงาน):
- Login: 0000
- รีเฟรชหน้า
- ✅ เห็น "น้ำอัดลม" ทันที!
```

---

## 🔒 Security Rules

ไฟล์ `firestore.rules` ถูกอัปเดตแล้ว:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow authenticated users to access documents "0000" or "552499"
    match /inventory/{code} {
      allow read, write: if request.auth != null && 
                            (code == "0000" || code == "552499");
    }
    
    match /settings/{code} {
      allow read, write: if request.auth != null && 
                            (code == "0000" || code == "552499");
    }
    
    match /audit/{code} {
      allow read, write: if request.auth != null && 
                            (code == "0000" || code == "552499");
    }
    
    match /counts/{code} {
      allow read, write: if request.auth != null && 
                            (code == "0000" || code == "552499");
    }
  }
}
```

### ⚠️ สำคัญ: ต้อง Deploy Rules ใน Firebase Console!

1. ไปที่ [Firebase Console](https://console.firebase.google.com)
2. เลือก Project: **pos-mick-an-petch**
3. ไปที่ **Firestore Database** → **Rules**
4. คัดลอกเนื้อหาจากไฟล์ `firestore.rules`
5. Paste และกด **Publish**

---

## 🚀 สิ่งที่เปลี่ยนแปลง

### ก่อนแก้ไข ❌
```
Firebase Anonymous Auth
├── User UID: abc123 (เครื่อง A)
├── User UID: def456 (เครื่อง B)
└── User UID: ghi789 (เครื่อง C)

❌ แต่ละเครื่องข้อมูลแยกกัน
```

### หลังแก้ไข ✅
```
Firebase Anonymous Auth (for token) + Login Code (for data)
├── Document ID: 0000    (พนักงานทุกเครื่อง)
└── Document ID: 552499  (ผู้จัดการทุกเครื่อง)

✅ เครื่องที่ใช้รหัสเดียวกันเห็นข้อมูลเดียวกัน!
```

---

## 📝 ไฟล์ที่แก้ไข

1. ✅ `src/lib/firebaseAuth.ts` - ใช้ Login Code แทน Firebase UID
2. ✅ `src/pages/LoginPage.tsx` - เซ็ต Login Code เมื่อ login
3. ✅ `src/App.tsx` - ลบการโหลดข้อมูลตอนเริ่ม (โหลดหลัง login แทน)
4. ✅ `firestore.rules` - อัปเดต Security Rules

---

## 🎯 Use Cases

### Use Case 1: ร้านมีพนักงาน 3 คน
```
พนักงาน A (มือถือ)     → Login: 0000 → นับสต็อกไก่สด
พนักงาน B (iPad)       → Login: 0000 → นับสต็อกข้าว
พนักงาน C (คอมพิวเตอร์) → Login: 0000 → ดูรายการสั่งซื้อ

✅ ทุกคนเห็นข้อมูลอัพเดทแบบ Real-time (หลังรีเฟรช)
```

### Use Case 2: เจ้าของควบคุมจากหลายที่
```
เจ้าของ (มือถือที่บ้าน)      → Login: 552499 → เช็ครายงาน
เจ้าของ (คอมพิวเตอร์ที่ร้าน) → Login: 552499 → จัดการสินค้า
เจ้าของ (iPad)              → Login: 552499 → ตั้งค่าระบบ

✅ เจ้าของเห็นข้อมูลเดียวกันทุกอุปกรณ์
```

### Use Case 3: แยกข้อมูลพนักงาน vs ผู้จัดการ
```
พนักงาน (0000):
- เห็นเฉพาะข้อมูล Document "0000"
- นับสต็อก, ดูรายการสั่งซื้อ

ผู้จัดการ (552499):
- เห็นเฉพาะข้อมูล Document "552499"
- จัดการสินค้า, ดูรายงาน, ตั้งค่า

❗ ข้อมูลแยกกันระหว่าง 2 กลุ่ม
```

---

## ⚠️ ข้อควรระวัง

### 1. ข้อมูลแยกตาม Login Code
- พนักงาน (0000) และ ผู้จัดการ (552499) **เห็นข้อมูลคนละชุด**
- ถ้าต้องการให้เห็นเหมือนกัน ให้ทุกคนใช้รหัสเดียวกัน

### 2. รหัสต้องตรงกับ Firestore Rules
- ตอนนี้รองรับแค่ "0000" และ "552499"
- ถ้าเปลี่ยนรหัสใน Settings ต้องอัปเดต `firestore.rules` ด้วย

### 3. Refresh เพื่อเห็นการเปลี่ยนแปลง
- ระบบไม่ใช่ Real-time แบบทันที
- ต้องรีเฟรชหน้าเพื่อดึงข้อมูลใหม่จาก Firebase

### 4. ความเป็นส่วนตัว
- ทุกคนที่รู้รหัส 0000 จะเข้าถึงข้อมูลเดียวกันได้
- เหมาะสำหรับทีมที่ทำงานร่วมกัน

---

## 🧪 การทดสอบ

### ทดสอบ 1: เครื่องเดียวกัน
```
1. Login: 0000
2. เพิ่มสินค้า "ทดสอบ"
3. Logout
4. Login: 0000 อีกครั้ง
5. ✅ ต้องเห็น "ทดสอบ"
```

### ทดสอบ 2: คนละเครื่อง
```
เครื่อง A:
1. Login: 0000
2. เพิ่มสินค้า "แตงโม"
3. บันทึก

เครื่อง B:
1. Login: 0000
2. รีเฟรชหน้า
3. ✅ ต้องเห็น "แตงโม"
```

### ทดสอบ 3: แยกข้อมูล
```
เครื่อง A:
1. Login: 0000 (พนักงาน)
2. เพิ่ม "สินค้าพนักงาน"

เครื่อง B:
1. Login: 552499 (ผู้จัดการ)
2. ❌ ไม่เห็น "สินค้าพนักงาน"
3. เห็นเฉพาะข้อมูลของ 552499
```

---

## 📚 เอกสารเพิ่มเติม

- `FIREBASE_SETUP.md` - คู่มือ Firebase ทั่วไป
- `README.md` - คู่มือใช้งานหลัก
- `firestore.rules` - Security Rules

---

## 🎉 สรุป

ระบบตอนนี้:
- ✅ ใช้ Login Code เป็น Document ID
- ✅ ทุกเครื่องที่ใช้รหัสเดียวกันเห็นข้อมูลเดียวกัน
- ✅ พนักงาน (0000) ทำงานร่วมกันได้
- ✅ ผู้จัดการ (552499) ควบคุมจากหลายอุปกรณ์ได้
- ✅ ข้อมูลแยกระหว่างพนักงานกับผู้จัดการ
- ✅ Online-only, ต้องมีเน็ต

**เริ่มใช้งานได้เลย!** 🚀

